---
title: "How do I use custom compilers or toolchain flags?"
description: "Describes methods for setting custom compiler paths or arguments, overriding make, and configuring architecture- or platform-specific build behavior via options or environment variables."
---

# How do I use custom compilers or toolchain flags?

This page guides you through customizing the compiler, build tools, and related flags in `node-gyp` builds. You will learn how to specify alternative compiler binaries, override the default `make` command, and adjust architecture- or platform-specific flags using command-line options, environment variables, and `binding.gyp` configurations.

---

## Why customize compilers or toolchain flags?

Sometimes, the default compiler or build settings detected by `node-gyp` do not fit your project’s specific requirements or target environment. For example:

- You may want to use a newer or specialized compiler version.
- You need to pass custom flags to enable optimizations or debugging features.
- Your platform or toolchain requires different arguments or build commands.
- You want to override the default tool invoked to build your project (e.g., using `gmake` instead of `make`).

`node-gyp` provides flexible methods to achieve these goals while maintaining your build’s cross-platform compatibility.

---

## How to specify a custom compiler

`node-gyp` itself does not directly invoke the compiler binary but generates build files (Makefiles, MSBuild projects, or Xcode projects) that use the underlying platform’s build tools. To customize the compiler:

1. **Via environment variables:**

   - On Unix/macOS, set standard variables like `CC` (C compiler), `CXX` (C++ compiler), and `LD` (linker) to the desired compiler paths or commands before invoking `node-gyp`. For example:

   ```bash
   export CC=/usr/local/bin/clang
   export CXX=/usr/local/bin/clang++
   node-gyp configure build
   ```

   - On Windows, Visual Studio compilers are detected automatically. To override, you might need to configure MSBuild settings or use specific Visual Studio versions as described in Visual Studio setup guides.

2. **Via `binding.gyp` configurations:**

   You can include compiler flags in your `binding.gyp` file, which control the compilation behavior of the generated build files (see the “Adding compiler flags” section below).

3. **Using toolchain files or environment-specific scripts:**

   For advanced scenarios, generate a custom toolchain, or modify the environment so the build system picks the intended compilers and flags.

---

## Overriding `make` or build command

Use the `--make` option to override the `make` or build command that `node-gyp` invokes during the build step. This is especially useful on Unix platforms when the default `make` is unavailable or you prefer a different variant such as `gmake`.

```bash
node-gyp build --make=gmake
```

This applies when `node-gyp` runs the `make` command internally or invokes the build tool generated by the `configure` step.

---

## Setting custom compiler and linker flags via binding.gyp

The core way to customize compilation and linking flags for your native module is through the `binding.gyp` file. This lets you:

- Add flags globally or conditionally per platform or build configuration
- Add preprocessor defines
- Specify include directories
- Control platform-specific build options

### Examples:

```python
{
  'targets': [
    {
      'target_name': 'myaddon',
      'sources': [ 'src/myaddon.cc' ],
      'cflags!': [ '-fno-exceptions' ],  # Remove default flag on some platforms
      'cflags': [ '-Wall', '-O2' ],    # Add custom compile flags
      'defines': [ 'MY_DEFINE=1' ],   # Preprocessor definitions
      'include_dirs': [ 'include', '/usr/local/include' ],
      'ldflags': [ '-L/usr/local/lib', '-lmylib' ],

      # Conditional platform-specific flags
      'conditions': [
        [ 'OS=="win"', {
          'msvs_settings': {
            'VCCLCompilerTool': {
              'AdditionalOptions': [ '/WX' ],  # Treat warnings as errors on Windows
            },
          },
        }],
        [ 'OS=="mac"', {
          'xcode_settings': {
            'OTHER_CFLAGS': [ '-Wall' ],
          },
        }],
      ],
    },
  ],
}
```

This approach ensures that your build flags integrate cleanly with `node-gyp` and platform build tools such as MSBuild and Xcode.

---

## Specifying target architecture and platform

Set the `--arch` option when running `node-gyp` to target a specific CPU architecture:

```bash
node-gyp configure build --arch=ia32
```

This impacts the generated project files to compile for the selected architecture.

---

## Using environment variables and npm configurations

You can set any option available on the command line as an environment variable or npm config using the `node_gyp_` prefix in your environment.

For example, to override `make`:

```bash
export npm_package_config_node_gyp_make=gmake
node-gyp build
```

Or for custom flags, set environment variables or configure them in `package.json` under the `config` field with keys named `node_gyp_OPTIONNAME` (dashes replaced with underscores).

---

## Best practices and tips

- Use `binding.gyp` for all compiler and linker flag customizations to ensure consistency across all platforms.
- When overriding compilers, adjust your environment carefully to avoid conflicts.
- Use the `--verbose` flag to see detailed build logs and confirm your flags and compilers are correctly applied.
- For Windows, use the `--msvs_version` flag if you need to specify a particular Visual Studio version.
- Combining multiple settings (`cflags`, `ldflags`, `defines`) ensures a robust and clear build configuration.

---

## Common pitfalls

<Warning>
- Directly setting compiler binaries without environment variable adjustments usually won't affect the build because the underlying build system calls the compiler.
- Avoid hardcoding platform paths or compilers without conditionals in `binding.gyp` — always use conditions to maintain cross-platform compatibility.
- Passing compiler flags not supported by your compiler may cause failed builds.
</Warning>

---

## Troubleshooting

<AccordionGroup title="Troubleshooting Custom Compiler and Flags">
<Accordion title="My custom compiler is not being used. What should I check?">
Ensure you have set the environment variables `CC` and `CXX` appropriately before running `node-gyp configure`. Remember `node-gyp` generates project files that use standard build tools; the actual compiler must be discoverable by those tools.
</Accordion>
<Accordion title="I want to pass extra flags on Windows with Visual Studio, how?">
Use the `msvs_settings` block in your `binding.gyp` file. For example:

```python
'msvs_settings': {
  'VCCLCompilerTool': {
    'AdditionalOptions': [ '/WX' ],
  },
}
```

This passes `/WX` to the MSVC compiler to treat warnings as errors.
</Accordion>
<Accordion title="Overriding make results in command not found error. Why?">
Make sure the custom make command you specify with `--make` or environment variables is installed and in your `PATH`. For example, if you use `gmake`, it must be accessible from your shell.
</Accordion>
</AccordionGroup>

---

## Related documentation

- [binding.gyp file structure and examples](/faq/common-questions/binding-gyp-file)
- [Supported Development Workflows and Build Commands](/overview/core-concepts-and-architecture/supported-workflows)
- [Windows Visual Studio Setup](/getting-started/setup-prerequisites-installation/windows-visual-studio-setup)
- [Installing and Setting Up node-gyp](/guides/getting-started/installing-and-setting-up)
- [Optimizing Build Performance](/guides/integration-best-practices/optimizing-build-performance)

---